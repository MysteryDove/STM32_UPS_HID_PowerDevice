APC HID (NUT usbhid-ups) — apc-hid.c summary + processed usages + tree
=====================================================================

Summary (what apc-hid.c does)
-----------------------------
- Matches APC USB HID devices (VID 0x051d) via a USB ID table and applies model-specific tweaks:
  - disables interrupt pipe on some “5G” models (interrupt endpoint used for a proprietary protocol)
  - applies max-report-size workarounds for some Back-UPS models which misbehave for certain Report IDs
- Provides APC vendor-usage name mappings (so vendor usages are presented as readable object paths).
- Defines the HID→NUT mapping table (apc_hid2nut[]): which HID object paths are exported as NUT variables,
  which are RW, which are instant commands, and which need conversions/scaling.
- Implements a report-descriptor fixup for a specific APC PID: patches incorrect logical min/max for some
  standard Power Device voltage-related fields by locating items by (ReportID, Usage).

Processed usages (HID object paths referenced by apc_hid2nut[])
--------------------------------------------------------------

Battery / PowerSummary
- UPS.PowerSummary.RemainingCapacity
- UPS.PowerSummary.RemainingCapacityLimit            (RW)
- UPS.PowerSummary.WarningCapacityLimit
- UPS.PowerSummary.RunTimeToEmpty
- UPS.PowerSummary.RemainingTimeLimit                (RW)
- UPS.PowerSummary.Voltage
- UPS.PowerSummary.ConfigVoltage
- UPS.PowerSummary.iDeviceChemistry
- UPS.PowerSummary.ManufacturerDate
- UPS.PowerSummary.AudibleAlarmControl
- UPS.PowerSummary.DelayBeforeStartup                (RW + timers/cmds)
- UPS.PowerSummary.DelayBeforeShutdown               (RW + timers/cmds)
- UPS.PowerSummary.DelayBeforeReboot                 (timers/cmds)
- UPS.PowerSummary.APCBattReplaceDate                (APC vendor usage)
- UPS.PowerSummary.APCPanelTest                      (APC vendor usage, cmd)
- UPS.PowerSummary.PresentStatus.ACPresent
- UPS.PowerSummary.PresentStatus.Discharging
- UPS.PowerSummary.PresentStatus.Charging
- UPS.PowerSummary.PresentStatus.ShutdownImminent
- UPS.PowerSummary.PresentStatus.BelowRemainingCapacityLimit
- UPS.PowerSummary.PresentStatus.Overload
- UPS.PowerSummary.PresentStatus.NeedReplacement
- UPS.PowerSummary.PresentStatus.RemainingTimeLimitExpired
- UPS.PowerSummary.PresentStatus.BatteryPresent

Older/alternate forms (seen on some models)
- UPS.PowerSummary.Charging
- UPS.PowerSummary.Discharging
- UPS.PowerSummary.ACPresent
- UPS.PowerSummary.BelowRemainingCapacityLimit
- UPS.PowerSummary.ShutdownImminent
- UPS.PowerSummary.APCStatusFlag                     (APC vendor usage)

Battery
- UPS.Battery.RunTimeToEmpty
- UPS.Battery.RemainingTimeLimit                     (RW)
- UPS.Battery.Voltage
- UPS.Battery.ConfigVoltage
- UPS.Battery.Temperature                            (Kelvin → Celsius conversion)
- UPS.Battery.ManufacturerDate                       (RW)
- UPS.Battery.APCBattReplaceDate                     (APC vendor usage)
- UPS.Battery.Test                                   (read + cmd)

BatterySystem
- UPS.BatterySystem.Battery.Test                     (cmd)

UPS / Input / Output / Converter
- UPS.ManufacturerDate
- UPS.Output.PercentLoad
- UPS.PowerConverter.PercentLoad
- UPS.PowerConverter.ConfigActivePower
- UPS.Output.ConfigActivePower

Input
- UPS.Input.Voltage
- UPS.Input.ConfigVoltage
- UPS.Output.LowVoltageTransfer                      (RW)  [used as input.transfer.low on some models]
- UPS.Output.HighVoltageTransfer                     (RW)  [used as input.transfer.high on some models]
- UPS.Input.LowVoltageTransfer                       (RW)  [alt for some models]
- UPS.Input.HighVoltageTransfer                      (RW)  [alt for some models]
- UPS.Input.APCSensitivity                           (APC vendor usage, RW enum)
- UPS.Input.APCLineFailCause                          (APC vendor usage; decoded into input.transfer.reason)

Output
- UPS.Output.Voltage
- UPS.Output.ConfigVoltage
- UPS.Output.Current
- UPS.Output.Frequency
- UPS.Output.DelayBeforeStartup                      (RW + timers/cmds)
- UPS.Output.DelayBeforeShutdown                     (RW + timers/cmds)
- UPS.Output.DelayBeforeReboot                       (timers/cmds)
- UPS.Output.APCDelayBeforeReboot                    (APC vendor usage, cmd)

APC-specific collections
- UPS.APCGeneralCollection.APCDelayBeforeStartup     (vendor, RW/timer/cmd)
- UPS.APCGeneralCollection.APCDelayBeforeShutdown    (vendor, RW/timer/cmd)
- UPS.APCGeneralCollection.APCDelayBeforeReboot      (vendor, timer/cmd)
- UPS.APCPanelTest                                   (vendor, cmd)
- UPS.APCEnvironment.APCProbe1.Temperature           (vendor, Kelvin → Celsius)
- UPS.APCEnvironment.APCProbe1.Humidity              (vendor)

APC vendor-defined usage names recognized (apc_usage_lkp[])
----------------------------------------------------------
- APCGeneralCollection              (0xff860005)
- APCEnvironment                    (0xff860006)
- APCProbe1                         (0xff860007)
- APCProbe2                         (0xff860008)
- APCBattReplaceDate                (0xff860016)
- APCBattCapBeforeStartup           (0xff860019)
- APC_UPS_FirmwareRevision          (0xff860042)
- APCLineFailCause                  (0xff860052)
- APCStatusFlag                     (0xff860060)
- APCSensitivity                    (0xff860061)
- APCPanelTest                      (0xff860072)
- APCShutdownAfterDelay             (0xff860076)
- APC_USB_FirmwareRevision          (0xff860079)
- APCDelayBeforeReboot              (0xff86007c)
- APCDelayBeforeShutdown            (0xff86007d)
- APCDelayBeforeStartup             (0xff86007e)
- Legacy/special BUP*:
  - BUPHibernate                    (0x00850058)
  - BUPBattCapBeforeStartup         (0x00860012)
  - BUPDelayBeforeStartup           (0x00860076)
  - BUPSelfTest                     (0x00860010)

Report-descriptor fixup touches (by ReportID + standard PDC usage)
-----------------------------------------------------------------
- ReportID 0x33 + USAGE_POW_HIGH_VOLTAGE_TRANSFER
- ReportID 0x31 + USAGE_POW_VOLTAGE
- ReportID 0x30 + USAGE_POW_CONFIG_VOLTAGE

Tree structure of HID paths used by apc_hid2nut[]
-------------------------------------------------
UPS
├─ ManufacturerDate
├─ PowerSummary
│  ├─ RemainingCapacity
│  ├─ RemainingCapacityLimit
│  ├─ WarningCapacityLimit
│  ├─ RunTimeToEmpty
│  ├─ RemainingTimeLimit
│  ├─ Voltage
│  ├─ ConfigVoltage
│  ├─ iDeviceChemistry
│  ├─ ManufacturerDate
│  ├─ AudibleAlarmControl
│  ├─ DelayBeforeStartup
│  ├─ DelayBeforeShutdown
│  ├─ DelayBeforeReboot
│  ├─ APCBattReplaceDate                 (vendor)
│  ├─ APCPanelTest                       (vendor)
│  └─ PresentStatus
│     ├─ ACPresent
│     ├─ Discharging
│     ├─ Charging
│     ├─ ShutdownImminent
│     ├─ BelowRemainingCapacityLimit
│     ├─ Overload
│     ├─ NeedReplacement
│     ├─ RemainingTimeLimitExpired
│     ├─ BatteryPresent
│     └─ APCStatusFlag                   (vendor)
├─ Battery
│  ├─ RunTimeToEmpty
│  ├─ RemainingTimeLimit
│  ├─ Voltage
│  ├─ ConfigVoltage
│  ├─ Temperature
│  ├─ ManufacturerDate
│  ├─ APCBattReplaceDate                 (vendor)
│  └─ Test
├─ BatterySystem
│  └─ Battery
│     └─ Test
├─ Input
│  ├─ Voltage
│  ├─ ConfigVoltage
│  ├─ LowVoltageTransfer
│  ├─ HighVoltageTransfer
│  ├─ APCSensitivity                     (vendor)
│  └─ APCLineFailCause                   (vendor)
├─ Output
│  ├─ PercentLoad
│  ├─ Voltage
│  ├─ ConfigVoltage
│  ├─ Current
│  ├─ Frequency
│  ├─ LowVoltageTransfer
│  ├─ HighVoltageTransfer
│  ├─ DelayBeforeStartup
│  ├─ DelayBeforeShutdown
│  ├─ DelayBeforeReboot
│  ├─ ConfigActivePower
│  └─ APCDelayBeforeReboot               (vendor)
├─ PowerConverter
│  ├─ PercentLoad
│  └─ ConfigActivePower
├─ APCGeneralCollection                  (vendor)
│  ├─ APCDelayBeforeStartup
│  ├─ APCDelayBeforeShutdown
│  └─ APCDelayBeforeReboot
└─ APCEnvironment                        (vendor)
   └─ APCProbe1                          (vendor)
      ├─ Temperature
      └─ Humidity